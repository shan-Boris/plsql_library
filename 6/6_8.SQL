-- Вывести список просроченных книг и их держателей со сроком просрочки

SELECT 
    TITLE, 
    LISTAGG(A.FIRST_NAME||' '||A.LAST_NAME||' '||A.FATHER_NAME, '; ') AS AUTHORS, 
    PUBLISHER, 
    C.FIRST_NAME||' '||C.LAST_NAME||' '||C.FATHER_NAME AS CLIENT, 
    ROUND(SYSDATE - DRB.TAKE_BOOK - 14)  AS OVERDUE_D
FROM LOG_DELIVERY_RETURN_BOOK DRB 
    JOIN BOOK B 
        ON (B.ID = DRB.ID_BOOK)
    JOIN AUTHOR_WROTE_BOOK AWB 
        ON (AWB.ID_BOOK = B.ID)
    JOIN AUTHOR A 
        ON(A.ID = AWB.ID_AUTHOR)
    JOIN PUBLISHER P 
        ON (P.ID = B.ID_PUBLISHER) 
    JOIN CLIENT C 
        ON (C.ID = DRB.ID_CLIENT)
WHERE DRB.RETURN_BOOK IS NULL 
    AND ROUND(SYSDATE - DRB.TAKE_BOOK) > 14
GROUP BY TITLE, PUBLISHER, SYSDATE - DRB.TAKE_BOOK, C.FIRST_NAME||' '||C.LAST_NAME||' '||C.FATHER_NAME;


